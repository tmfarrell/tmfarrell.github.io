{%- assign portfolio = site.data.portfolio | sort: "date" | reverse -%}
{%- if include.limit and portfolio.size > include.limit -%}
  {%- assign limited_portfolio = portfolio | slice: 0, include.limit -%}
  {%- assign limit_exceeded = true -%}
{%- else -%}
  {%- assign limited_portfolio = portfolio -%}
  {%- assign limit_exceeded = false -%}
{%- endif -%}

{%- if portfolio.size > 0 -%}

<!-- Filter Toggle Button -->
<button class="filter-toggle" id="filter-toggle-portfolio">
  <svg class="filter-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
    <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
  </svg>
</button>

<!-- Filter Container (Hidden by default) -->
<div class="filter-container" id="filter-container-portfolio">
  <div class="filter-controls">
    <div class="tag-cloud" id="tag-cloud-portfolio"></div>
    <div class="filter-actions">
      <button id="clear-filter-portfolio">Clear</button>
    </div>
  </div>
</div>

<ul class="portfolio-list" style="list-style:none;" id="portfolio-list" data-category="portfolio">
  {%- for item in limited_portfolio -%}
  <li class="portfolio-list-item preview-item" data-tags="{% if item.tags %}{{ item.tags | join: ',' }}{% endif %}" data-date="{{ item.date | date: '%Y-%m-%d' }}" data-org="{{ item.org | downcase }}" data-portfolio-id="{{ item.id }}">
    
    <!-- Main portfolio item row - expandable area -->
    <div class="portfolio-item-header" role="button" tabindex="0" aria-expanded="false">
      <span class="portfolio-date">{{ item.date | date: "%Y-%m " }}</span>
      <span class="portfolio-title-section">
        {%- if item.link contains "http" -%}
        <a href="{{ item.link }}" class="portfolio-link" onclick="event.stopPropagation()">{{ item.title }}</a>
        {%- else -%}
        <a href="{{ item.link | relative_url }}" class="portfolio-link" onclick="event.stopPropagation()">{{ item.title }}</a>
        {%- endif -%}
      </span>
      {% if item.tags and item.tags.size > 0 %}
        <span class="post-tags">
          {% for tag in item.tags %}
            <span class="tag">{{ tag }}</span>
          {% endfor %}
        </span>
      {% endif %}
    </div>

    <!-- Expandable content area -->
    <div class="portfolio-item-content" aria-hidden="true">
      <div class="portfolio-details">
        <div class="portfolio-description">
          {{ item.description }}
        </div>

      </div>
    </div>
  </li>
  {%- endfor -%}
  {%- if limit_exceeded -%}
    {%- assign remaining_portfolio = portfolio | slice: include.limit, portfolio.size -%}
    {%- for item in remaining_portfolio -%}
    <li class="portfolio-list-item additional-item" data-tags="{% if item.tags %}{{ item.tags | join: ',' }}{% endif %}" data-date="{{ item.date | date: '%Y-%m-%d' }}" data-org="{{ item.org | downcase }}" data-portfolio-id="{{ item.id }}">
      
      <!-- Main portfolio item row - expandable area -->
      <div class="portfolio-item-header" role="button" tabindex="0" aria-expanded="false">
        <span class="portfolio-date">{{ item.date | date: "%Y-%m " }}</span>
        <span class="portfolio-title-section">
          {%- if item.link contains "http" -%}
          <a href="{{ item.link }}" class="portfolio-link" onclick="event.stopPropagation()">{{ item.title }}</a>
          {%- else -%}
          <a href="{{ item.link | relative_url }}" class="portfolio-link" onclick="event.stopPropagation()">{{ item.title }}</a>
          {%- endif -%}
        </span>
        {% if item.tags and item.tags.size > 0 %}
          <span class="post-tags">
            {% for tag in item.tags %}
              <span class="tag">{{ tag }}</span>
            {% endfor %}
          </span>
        {% endif %}
      </div>

      <!-- Expandable content area -->
      <div class="portfolio-item-content" aria-hidden="true">
        <div class="portfolio-details">
          <div class="portfolio-description">
            {{ item.description }}
          </div>

        </div>
      </div>
    </li>
    {%- endfor -%}
  {%- endif -%}
  {%- if include.show_more and limit_exceeded -%}
  <li class="show-more-item"><a href="{{ include.show_more_url | default: '/building/archive/' | relative_url }}">{{ include.show_more_text | default: "See more..." }}</a></li>
  {%- endif -%}
</ul>
{%- endif -%}
